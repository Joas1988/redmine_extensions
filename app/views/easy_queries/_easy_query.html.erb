<%
  easy_query ||= @easy_query
variables = {
  easy_query_name: easy_query.name,
  block_name: 'easy_query', container_id: easy_query.entity.name.pluralize.underscore,
  groups_url: params,
  options: {}, form_options: {}
}.merge(local_assigns)
variables[:options][:hascontextmenu] = true if !options.key?(:hascontextmenu)
variables[:modul_uniq_id] ||= variables[:container_id]
%>

<% present(easy_query, variables) do |presenter| %>
  <% if presenter.render_exports? %>
    <%= easy_render_pdf_format_options_dialog(easy_query, params) if easy_query.new_record? %>
    <%= easy_render_csv_format_options_dialog(easy_query, params) if easy_query.new_record? %>
    <%= easy_render_xlsx_format_options_dialog(easy_query, params) if easy_query.new_record? %>
  <% end %>

  <%= render :partial => 'easy_queries/easy_query_index', :locals => {:query => easy_query, :easy_query_name => easy_query_name, :options => variables[:options]}.merge(variables[:form_options]) %>

  <%= presenter.render_zoom_links %>

  <% if easy_query.chart_support? && easy_query.chart? %>
    <%= render :partial => 'easy_queries/easy_query_chart', :locals => {:block_name => variables[:block_name], :easy_query => easy_query} %>
  <% end %>
  <% if easy_query.calendar_support? && easy_query.calendar? %>
    <%= render :partial => 'easy_queries/easy_query_calendar', :locals => {:block_name => variables[:block_name], :easy_query => easy_query} %>
  <% end %>
  <% presenter.outputs.each do |output| %>
    <%= output.render_data %>
  <% end %>

  <% if presenter.render_exports? %>
    <%= render(:partial => 'easy_queries/easy_query_export_format_links', :locals => {:query => easy_query}) -%>
  <% end %>

<% end %>
