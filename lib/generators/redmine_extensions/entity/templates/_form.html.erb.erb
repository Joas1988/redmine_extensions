<%%= fields_for :<%= model_name_underscored %>, <%= model_name_underscored %> do |f| %>
  <% if project? %>
  <%% if <%= model_name_underscored %>.new_record? && !@project %>
  <p>
    <%%= f.label :project_id %>
    <%%= f.select :project_id, Project.allowed_to(:manage_<%= model_name_pluralize_underscored %>).collect{|x| [x.name, x.id]}, include_blank: true %>
  </p>
  <%% end %>
  <% end %>
  <% form_columns.each do |column_name, column_options| %>
  <p>
    <%%= f.label :<%= column_name %> %>
    <% if column_options[:query_type] == 'string' || column_options[:query_type] == 'integer' %>
    <%%= f.text_field :<%= column_name %> %>
    <% elsif column_options[:query_type] == 'list' || column_options[:query_type] == 'list_optional'%>
    <%%= f.select :<%= column_name %>, <%= column_options[:class] %>.all.collect{|x| [x.<%= column_options[:list_class_name] %>, x.id]}, include_blank: true %>
    <% end %>
  </p>
  <% end %>
  <% if acts_as_customizable? %>
  <%% custom_field_values = <%= model_name_underscored %>.visible_custom_field_values %>
  <%% custom_field_values.each do |value| %>
  <p>
    <%%= custom_field_tag_with_label :<%= model_name_underscored %>, value %>
  </p>
  <%% end %>
  <% end -%>
<%% end %>